window.WPEM=window.WPEM||{},jQuery(document).ready(function(a){function b(b,d){if(void 0!==d.slug)return void c(d,b);a.ajax({type:"GET",url:wpem_theme_vars.api_url,dataType:"jsonp",data:{action:"get_theme",theme:d},success:function(a){wpem_theme_vars.themes[b]=a,c(a,b)}})}function c(b,c){var f=a("#wpem-template-theme"),g=a(".theme-browser .themes"),i=a(a.trim(f.clone().html())),j=void 0!==b.slug?b.slug:"",k=void 0!==b.name?b.name:"",l=void 0!==b.author?b.author:"",m=void 0!==b.screenshot_url?b.screenshot_url:"";a(i).appendTo(g),i.addClass(j),i.attr("data-theme",j),h&&a(".theme .more-details").text(wpem_theme_vars.i18n.select),m?i.find(".theme-screenshot img").attr("src",m):(i.find(".theme-screenshot").addClass("blank"),i.find(".theme-screenshot img").remove()),i.find(".theme-author span").text(l),i.find(".theme-name").text(k),i.on("click",".theme-actions a",function(b){return b.preventDefault(),d(a(this).closest(".theme")),!1}),i.on("click",function(){a("body").addClass("wpem-theme-preview"),e(b,c)})}function d(b){a("#wpem_selected_theme").val(b.data("theme")),b.removeClass("hover").addClass("active"),a(".wpem-screen").find("form").submit()}function e(b,c){a("body").addClass("wpem-theme-preview");var i=a("#wpem-template-theme-preview"),j=a(".wrap"),k=a("#wpem-template-customizations"),l=a(a.trim(i.clone().html())),m=l.find("#wpem-template-customizations-wrapper"),n=void 0!==b.slug?b.slug:"",o=void 0!==b.name?b.name:"",p=void 0!==b.author?b.author:"",q=void 0!==b.version?b.version:"",r=wpem_theme_vars.preview_url+"&theme="+b.slug,s=void 0!==b.screenshot_url?b.screenshot_url:"",t=void 0!==b.description?b.description:"";if(h)return void a.ajax({type:"POST",url:wpem_theme_vars.ajax_url,data:{action:"wpem_switch_theme",theme:n,nonce:wpem_theme_vars.ajax_nonce},complete:function(){window.location.href=wpem_theme_vars.customizer_url}});m.html(k.html());var u=m.find("li.selected a"),v=a("#wpem_selected_header_image_url");void 0!==u.data("image-preview-url")&&(r+="&header_image="+encodeURIComponent(u.data("image-preview-url")),v.val(u.data("image-url")));var w=m.find('.color-option.selected input[name="wpem_color_scheme"]'),x=a("#wpem_selected_color_scheme");void 0!==w&&(r+="&color_scheme="+encodeURIComponent(w.val()),x.val(w.val())),a(l).appendTo(j).show(),l.find(".theme-name").text(o),l.find(".theme-by span").text(p),l.find(".theme-screenshot").attr("src",s),l.find(".theme-version span").text(q),"WooThemes"===p&&b.premium_theme&&l.find(".premium-theme-notice").html('<div class="woo-theme-help-link"><h4>'+b.premium_theme_label+'</h4><p class="woo-theme-help-text">'+b.premium_theme_disclaimer+"</p></div>");var y=m.is(":empty")?t:g(t,140,"&nbsp;&hellip;");l.find(".theme-description").html(y),f();var z=l.find(".wp-full-overlay-main");z.append("<iframe>"),z.find("iframe").attr("src",r),l.on("click","a.previous-theme",function(a){a.preventDefault(),c=0===c?wpem_theme_vars.themes.length-1:c-1;var b=wpem_theme_vars.themes[c];l.remove(),e(b,c)}),l.on("click","a.next-theme",function(a){a.preventDefault(),c=wpem_theme_vars.themes.length-1===c?0:c+1;var b=wpem_theme_vars.themes[c];l.remove(),e(b,c)}),l.on("click",".color-option",function(b){if(b.preventDefault(),!a(this).hasClass("selected")){var c=a(".wp-full-overlay-main iframe"),d=a(this),e=(a('.color-option.selected input[name="wpem_color_scheme"]').val(),d.find('input[type="radio"]').val()),f=c.attr("src");d.hasClass("selected")?f=f.replace("&color_scheme="+e,""):(f=f+"&color_scheme="+e,a(".color-option").removeClass("selected")),d.toggleClass("selected"),k.html(m.html()),x.val(e),c.on("load",function(){c.css("opacity",1),c.off("load")}),c.css("opacity",0),c.attr("src",f)}}),l.on("click","a.theme-install",function(b){b.preventDefault();var c=a(".theme."+n);l.find("a.close-full-overlay").click(),d(c)}),l.on("click","a.close-full-overlay",function(b){b.preventDefault(),a("body").removeClass("wpem-theme-preview"),l.remove(),a("body").removeClass("wpem-theme-preview")}),l.on("click",".wpem-header-images-list li:not(.load-more) a",function(b){b.preventDefault();var c=a(this),d=c.parent(),e=encodeURIComponent(c.data("image-preview-url")),f="",g=a(".wp-full-overlay-main iframe");!d.hasClass("selected")&&d.siblings(".selected").length>0&&(f=encodeURIComponent(d.siblings(".selected").find("a").data("image-preview-url")),d.siblings().removeClass("selected")),d.toggleClass("selected"),k.html(m.html());var h=g.attr("src");d.hasClass("selected")?h=""===f?h+"&header_image="+e:h.replace(f,e):(h=h.replace("&header_image="+e,""),e=""),v.val(e?c.data("image-url"):""),g.on("load",function(){g.css("opacity",1),g.off("load")}),g.css("opacity",0),g.attr("src",h)}),l.on("click",".wpem-header-images-list li.load-more a",function(b){b.preventDefault();var c=a(this),d=c.parent();d.empty().addClass("spinner"),a.get(c.attr("href"),function(a){d.replaceWith(a),k.html(m.html())})});var A=a(".theme-install-overlay"),B=A.find(".devices button");a("button.collapse-sidebar").on("click",function(){return"true"===a(this).attr("aria-expanded")?(window.WPEM.Pointers.hideAll(),a(this).attr({"aria-expanded":"false","aria-label":wpem_theme_vars.i18n.expand}),B.hide()):(setTimeout(function(){f(),B.show()},200),a(this).attr({"aria-expanded":"true","aria-label":wpem_theme_vars.i18n.collapse})),a(this).toggleClass("collapsed").toggleClass("expanded"),a(".wp-full-overlay").toggleClass("collapsed").toggleClass("expanded"),!1}),B.on("click",function(b){var c=a(b.currentTarget).data("device");A.removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+c).data("current-preview-device",c);var d=a(".wp-full-overlay-footer .devices");d.find("button").removeClass("active").attr("aria-pressed",!1),d.find("button.preview-"+c).addClass("active").attr("aria-pressed",!0)})}function f(){window.WPEM.Pointers.openFirstInRange("wpem_theme_preview_",[1,2,3])}function g(a,b,c){if(a.length<=b)return a;for(var d=a.split(" "),e=d[0].length,f=1;f<d.length&&!(e===b||e+d[f].length+1>b);f++)e+=d[f].length+1;return d.slice(0,f).join(" ")+(c||"")}a(document).on("click",".image-license",function(b){b.preventDefault(),a(this).parent().replaceWith('<p class="description">'+wpem_theme_vars.i18n.image_license+"</p>")}),a(document).on("mouseenter",".theme",function(){a(".theme").removeClass("hover")}),a(document).on("keyup",function(b){9===b.keyCode&&(a(".theme").removeClass("hover"),a("a.preview-theme:focus").closest(".theme").addClass("hover"))}),a(document).on("keydown",function(b){switch(b.keyCode){case 27:a("a.close-full-overlay").click();break;case 37:a("a.previous-theme").click();break;case 39:a("a.next-theme").click()}}),a(document).on("click","#sections .section-title",function(b){b.preventDefault();var c=a(this);if(!c.hasClass("active")){var d=c.data("section"),e=a("#hidden-sections").find(".section");a(".section-title").removeClass("active"),c.addClass("active"),e.hide(),a("#"+d).fadeIn()}});var h=!1;0===wpem_theme_vars.themes.length&&(wpem_theme_vars.themes=wpem_theme_vars.default_themes,h=!0),a.each(wpem_theme_vars.themes,function(a,c){b(a,c)})});